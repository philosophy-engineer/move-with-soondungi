name: soondungi-api

services:
  api:
    image: ${API_IMAGE:?API_IMAGE is required}
    restart: always
    env_file:
      - ./.env.api
    ports:
      - "127.0.0.1:${API_PORT:-4000}:4000"
    healthcheck:
      test:
        [
          "CMD-SHELL",
          'node -e "fetch(''http://127.0.0.1:4000/healthz'').then((response) => { if (!response.ok) process.exit(1); }).catch(() => process.exit(1));"',
        ]
      interval: 15s
      timeout: 5s
      retries: 5
      start_period: 20s
